<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Parameter Adjustment</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            padding: 20px;
        }

        h1,
        h2 {
            color: red;
        }

        .tokens {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .tokens.negative {
            color: red;
        }

        .warning {
            color: red;
            font-size: 0.9rem;
            display: none;
        }

        button {
            margin-top: 20px;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="alert alert-warning text-center" role="alert">
            You can spend your tokens to improve or change the behaviour of your AI driver in the races. Screenshot when
            you are done and send it to Igiava.
        </div>
        <h1 class="text-center">AI Parameter Adjustment</h1>
        <div class="tokens">Remaining Tokens: <span id="tokens">200</span></div>
        <p class="warning" id="warning">Warning: You have exceeded your token limit!</p>

        <div class="section" id="speed-section">
            <h2>Speed Parameters</h2>
        </div>

        <div class="section" id="preference-section">
            <h2>Preference Parameters</h2>
        </div>

        <div class="text-center">
            <button class="btn btn-danger" onclick="resetAll()">Reset All to Default</button>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const parameters = [
            { name: "Slowdown %₀₀", category: "Speed", min: 0, max: 1000, default: 50, costs: 10 },
            { name: "Min Driving Line Quality", category: "Preference", min: 0, max: 100, default: 60, costs: 5 },
            { name: "Max Driving Line Quality", category: "Preference", min: 0, max: 100, default: 100, costs: 5 },
            { name: "Max Quality Range Narrowing", category: "Preference", min: 0, max: 1000, default: 50, costs: 3 },
            { name: "Ignore Slowdown Probability %₀₀", category: "Speed", min: 0, max: 1000, default: 0, costs: 3 },
            { name: "Overspeed Probability %₀₀", category: "Speed", min: 0, max: 1000, default: 0, costs: 3 },
            { name: "Limit Oversteering Probability %₀₀", category: "Speed", min: 0, max: 1000, default: 0, costs: 3 },
            { name: "Stuck Time Limit", category: "Preference", min: 1, max: 10, default: 5, costs: 2 },
            { name: "Distance for Full Correction", category: "Preference", min: 1, max: 50, default: 25, costs: 2 },
            { name: "Lateral Avoidance", category: "Preference", min: 0, max: 10, default: 4, costs: 2 },
            { name: "Overtake Time", category: "Preference", min: 0, max: 5, default: 3, costs: 2 },
            { name: "Overtake Space", category: "Preference", min: 1, max: 10, default: 3, costs: 2 },
            { name: "Random Path Variation", category: "Preference", min: 0, max: 200, default: 20, costs: 2 }
        ];

        let tokens = 200;
        const tokensDisplay = document.getElementById("tokens");
        const warning = document.getElementById("warning");

        function updateTokens() {
            tokensDisplay.textContent = tokens;
            if (tokens < 0) {
                tokensDisplay.classList.add("negative");
                warning.textContent = "Warning: You have exceeded your token limit!";
                warning.style.display = "block";
            } else if (tokens === 0) {
                tokensDisplay.classList.remove("negative");
                warning.textContent = "You assigned all tokens.";
                warning.style.display = "block";
            } else {
                tokensDisplay.classList.remove("negative");
                warning.textContent = "Assign points.";
                warning.style.display = "block";
            }
        }

        function resetAll() {
            parameters.forEach(param => {
                const slider = document.getElementById(param.name);
                slider.value = param.default;
                document.getElementById(`${param.name}-value`).textContent = `Current: ${param.default}`;
            });
            tokens = 200;
            updateTokens();
        }

        function resetParameter(name) {
            const slider = document.getElementById(name);
            const param = parameters.find(param => param.name === name);
            slider.value = param.default;
            document.getElementById(`${param.name}-value`).textContent = `Current: ${param.default}`;
            tokens = 200;
            updateTokens();
        }

        function updateSlider(slider) {
            const param = parameters.find(p => p.name === slider.id);
            const currentValue = parseInt(slider.value);
            const defaultValue = param.default;
            const difference = currentValue - defaultValue;

            let adjustment;
            if (param.name === "Slowdown %₀₀" || param.name === "Stuck Time Limit" || param.name === "Distance for Full Correction") {
                adjustment = -difference * param.costs;
            } else {
                adjustment = difference * param.costs;
            }

            tokens = 200 - parameters.reduce((total, p) => {
                const slider = document.getElementById(p.name);
                const value = parseInt(slider.value);
                const diff = value - p.default;
                return total + (p.name === "Slowdown %₀₀" || p.name === "Stuck Time Limit" || p.name === "Distance for Full Correction" ? -diff * p.costs : diff * p.costs);
            }, 0);

            document.getElementById(`${param.name}-value`).textContent = `Current: ${slider.value}`;
            updateTokens();
        }

        function createSlider(param) {
            const container = document.createElement("div");
            container.className = "slider-container row mb-3 align-items-center";

            const labelCol = document.createElement("div");
            labelCol.className = "col-md-6";
            const label = document.createElement("label");
            label.textContent = `${param.name} (Cost: ${param.costs}/unit)`;
            label.htmlFor = param.name;
            labelCol.appendChild(label);

            const sliderCol = document.createElement("div");
            const inputContainer = document.createElement("div");
            inputContainer.style.display = "flex";
            inputContainer.style.alignItems = "center";
            sliderCol.className = "col-md-4";

            const slider = document.createElement("input");
            slider.type = "range";
            slider.className = "form-range";
            slider.id = param.name;
            slider.min = param.min;
            slider.max = param.max;
            slider.value = param.default;
            slider.oninput = () => updateSlider(slider);
            inputContainer.appendChild(slider);
            const numberInput = document.createElement("input");
            numberInput.type = "number";
            numberInput.value = param.default;
            numberInput.min = param.min;
            numberInput.max = param.max;
            numberInput.style.marginLeft = "10px";
            numberInput.style.width = "60px";
            numberInput.oninput = () => {
                slider.value = numberInput.value;
                updateSlider(slider);
            };
            slider.oninput = () => {
                numberInput.value = slider.value;
                updateSlider(slider);
            };
            inputContainer.appendChild(numberInput);
            sliderCol.appendChild(inputContainer);

            const valueDisplay = document.createElement("div");
            valueDisplay.id = `${param.name}-value`;
            valueDisplay.textContent = `Current: ${param.default}`;
            valueDisplay.style.fontWeight = "bold";
            valueDisplay.style.marginTop = "10px";
            sliderCol.appendChild(valueDisplay);

            const buttonCol = document.createElement("div");
            buttonCol.className = "col-md-2 text-end";
            const resetButton = document.createElement("button");
            resetButton.textContent = "Reset";
            resetButton.className = "btn btn-danger btn-sm";
            resetButton.onclick = () => resetParameter(param.name);
            buttonCol.appendChild(resetButton);

            container.appendChild(labelCol);
            container.appendChild(sliderCol);
            container.appendChild(buttonCol);

            return container;
        }

        const speedSection = document.getElementById("speed-section");
        const preferenceSection = document.getElementById("preference-section");

        parameters.forEach(param => {
            const slider = createSlider(param);
            if (param.category === "Speed") {
                speedSection.appendChild(slider);
            } else if (param.category === "Preference") {
                preferenceSection.appendChild(slider);
            }
        });

        updateTokens();
    </script>
</body>

</html>